'use strict';Vue.component('calendar',{props:{events:{type:Array,required:!0},displayEvent:{type:Function,required:!0}},template:'\n        <div id="calendar"></div>\n    ',mounted:function mounted(){var a=this;$('#calendar').fullCalendar({header:{left:'prevYear,nextYear',center:'title',right:'today prev,next'},theme:!0,eventStartEditable:!1,eventDurationEditable:!1,eventClick:function eventClick(b){a.displayEvent(b)},events:this.loadEvents})},beforeDestroy:function beforeDestroy(){$('#calendar').fullCalendar('destory')},methods:{loadEvents:function loadEvents(a,b,c,d){var e=a.valueOf(),f=b.valueOf(),g=this.events.filter(function(h){return h.start.getTime()>=e&&h.start.getTime()<=f});d(g)}}}),Vue.component('chart',{props:{streakArray:{type:Array,required:!0}},template:'\n        <canvas id="chart" style="margin-top: 40px"></canvas>\n    ',mounted:function mounted(){var a=[];this.streakArray.forEach(function(c,d){a.push(d+1)});var b=document.getElementById('chart').getContext('2d');this.myChart=new Chart(b,{type:'line',data:{labels:a,datasets:[{label:'Your Streaks',data:this.streakArray,borderColor:'rgba(153, 0, 204, 0.7)',backgroundColor:'rgba(153, 0, 204, 0.5)',pointBackgroundColor:'rgb(153, 0, 204)'}]},options:{responsive:!0,scales:{yAxes:[{ticks:{callback:function callback(c){if(0==c%1)return c}}}]}}})},watch:{streakArray:function streakArray(a){this.myChart.data.datasets[0].data=a,this.myChart.update()}},data:function data(){return{myChart:null}}});var HabitDetails={props:{hash:{type:String,required:!0}},template:'\n        <div style="padding-bottom: 30px; font-family: \'Lobster\', cursive; margin-top: 20px" v-if="habit" class="container">\n\n            <day-viewer-modal v-if="dayViewData" v-on:destroy-modal="destroyModal" :title="dayViewData.title" :succeeded="dayViewData.success" :show-button="showEditButton" :edit-habit="editHabit"></day-viewer-modal>\n            <calendar-modal v-if="dayEditData" v-on:destroy-modal="destroyModal" :success="dayEditData.success" :day-description="dayEditData.title" :save-data="updateEvent"></calendar-modal>\n\n            <div><router-link to="/user/dashboard"><i class="material-icons" style="font-size: 40px">arrow_back</i></router-link></div>\n            <h4 class="center">{{habit.title}}</h4>\n            <div class="center grey-text" v-html="habit.description"></div>\n            <div>Max Streak: {{habit.streakDetails.maxStreak}}</div>\n            <div>Start Date: {{habit.startDate.toDateString()}}</div>\n\n            <div class="center" v-if="habit.foreverHabit">You have a lot of time but better work hard...</div>\n            <div class="center" v-else>Looks like you have only {{habit.daysLeft}} days left. So rather not waste time...</div>\n            \n            <calendar :events="events" :displayEvent="showEvent"></calendar>\n            <chart :streak-array="habit.streakDetails.streakResults"></chart>\n\n        </div>\n        <div v-else class="center" style="margin-top: 40px">\n            <load-animation></load-animation>\n        </div>\n    ',watch:{$route:'fetchHabit'},mounted:function mounted(){this.fetchHabit()},methods:{fetchHabit:function fetchHabit(){var a=this,b=new Date,c=b.getTimezoneOffset();$.ajax({type:'GET',url:'/habits/one/'+this.hash+'?timezone='+c,success:function success(d){if(d.success){a.habit=new BitBreaks(d.bitBreak,d.streakDetails);for(var e=[],f=0;f<a.habit.dailyStatus.length;f++)e.push(new CalendarDates(a.habit.dailyStatus[f],a.habit.startDate,f));a.events=e}else messageUtility.showMessages(d.message)},error:function error(d){messageUtility.handleError(d)}})},destroyModal:function destroyModal(a){$(a).modal('close'),this.dayViewData=null,'#calendarModal'===a&&(this.dayEditData=null)},showEvent:function showEvent(a){this.dayViewData=a;var b=new Date;b.setTime(b.getTime()-1e3*(60*b.getTimezoneOffset())),b.setUTCHours(0,0,0,0);var c=utilityFunctions.dateDiffAbsolute(b,a.start._d);this.showEditButton=-3<=c&&0>=c&&!this.habit.ended},editHabit:function editHabit(){this.dayEditData=this.dayViewData,$('#dayModal').modal('close')},updateEvent:function updateEvent(a,b){var c=this,d=this.habit.hash,e=new Date;e.setTime(e.getTime()-1e3*(60*e.getTimezoneOffset())),e.setUTCHours(0,0,0,0);var f=utilityFunctions.dateDiffAbsolute(e,this.dayEditData.start._d);if(null===d||void 0===d)return void messageUtility.showMessages('You\'re not playing fair!!!');if(null===f||void 0===f||null===a||void 0===a||null===b||void 0===b)return void messageUtility.showMessages('All fields are required. Please fill all of them');if(120<b.length)return void messageUtility.showMessages('Message length too long. Please reduce the size...');e=new Date;var g=e.getTimezoneOffset();$.ajax({type:'PATCH',contentType:'application/json',url:'/habits/one/'+d+'?timezone='+g,data:JSON.stringify({success:a,dayQuote:b,setDate:f}),success:function success(h){h.success?(c.dayEditData.success=h.updatedStatus.success,c.dayEditData.title=h.updatedStatus.quote,c.dayEditData.color=h.updatedStatus.success?'green':'red',$('#calendar').fullCalendar('updateEvent',c.dayEditData),$('#calendarModal').modal('close'),c.dayEditData=null,c.habit.streakDetails=h.streakDetails):messageUtility.showMessages(h.message)},error:function error(h){messageUtility.handleError(h)}})}},data:function data(){return{habit:null,events:[],dayViewData:null,dayEditData:null,showEditButton:!1}}};